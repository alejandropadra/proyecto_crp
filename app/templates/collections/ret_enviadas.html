{% extends 'layout.html' %}
{% from 'helpers/_forms.html' import render_field %}
{% block main %}
<main class="px-3 pt-3">
{% if current_user.nivel =="cliente" %}
    <div class="my-5 container table-responsive tabla w-75 w-100 "  >  
    <table id="example" class="dataTable table" style="width:100%;">
        <thead>
            <tr>
                <th>N° Retencion</th>
                <th>Estatus</th>
                <th>Fecha de registro</th>
            </tr>
        </thead>
        <tbody>
            {% for ret in retenciones %}
                
            <tr class="celda text-center"  style="cursor:pointer;">
                
                {% for clave, valor in ret.items() %}
                {% if clave == 'fechaact' %}
                <td>{{valor}}</td>
                {% elif clave == 'codigo'%}
                <td>{{valor}}</td>
                {% elif clave == 'status' %}
                <td>{% if valor == 'P' %}Pendiente{% elif valor == 'C' %}Confirmado{% endif %}</td>
                {% endif %}
                {% endfor %}
            </tr>
            
            {% endfor %}
        </tbody>

        <tfoot>
            <tr>
                <th>N° Retencion</th>
                <th>Estatus</th>
                <th>Fecha de registro</th>
            </tr>
        </tfoot>
    </table>
</div>



{% endif %}
</main>
{% endblock %}

{% block js%}
<script>

     // Función para obtener el valor de 'filtro' de la URL
    function getFilterFromUrl() {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get('filtro');
    }
    
    $(document).ready(function() {
        // Obtener el valor de 'filtro' de la URL
        var filterValue = getFilterFromUrl();
        console.log(filterValue)
    
        // Eliminar las clases predeterminadas de los botones
        $.fn.dataTable.Buttons.defaults.dom.button.className = '';
    
        var table = $('#example').DataTable({
            lengthChange: false,
            buttons: [
                {
                    extend: 'copy',
                    className: 'button-name'
                },
                {
                    extend: 'excel',
                    className: 'button-name'
                },
                {
                    extend: 'pdf',
                    className: 'button-name'
                },
                {
                    extend: 'pageLength',
                    className: 'button-name'
                }
            ],
            responsive: true
        });
    
        // Aplicar el filtro de búsqueda después de que el DataTable esté inicializado
        if (filterValue) {
            table.search(filterValue).draw();
        }
    
        table.buttons().container()
        .appendTo('#example_wrapper .col-md-6:eq(0)');
    });
    
    $(function () {
        $('[data-toggle="tooltip"]').tooltip()
    });

    
    
    </script>


{% endblock %}
